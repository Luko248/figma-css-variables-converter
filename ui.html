<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Figma CSS Variables Converter</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: #000000;
            font-size: 12px;
            line-height: 1.4;
            padding: 16px;
            min-width: 280px;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #000000;
        }

        .header p {
            font-size: 11px;
            color: #8c8c8c;
        }

        .section {
            margin-bottom: 20px;
            padding: 16px;
            background: #f8f8f8;
            border-radius: 8px;
            border: 1px solid #e6e6e6;
        }

        .section h2 {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #000000;
        }

        .button {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .button:last-child {
            margin-bottom: 0;
        }

        .button-primary {
            background: #0d99ff;
            color: #ffffff;
        }

        .button-primary:hover {
            background: #0b87e5;
        }

        .button-primary:active {
            background: #0975cc;
        }

        .button-secondary {
            background: #ffffff;
            color: #000000;
            border: 1px solid #e6e6e6;
        }

        .button-secondary:hover {
            background: #f5f5f5;
            border-color: #d0d0d0;
        }

        .button-secondary:active {
            background: #e8e8e8;
        }

        .button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            pointer-events: none;
        }

        .status {
            padding: 12px;
            border-radius: 6px;
            font-size: 11px;
            margin-bottom: 12px;
            text-align: center;
        }

        .status-success {
            background: #e8f7ed;
            color: #0d5520;
            border: 1px solid #a7e5b8;
        }

        .status-error {
            background: #ffeaea;
            color: #cc1e1e;
            border: 1px solid #ffb3b3;
        }

        .status-info {
            background: #e8f4ff;
            color: #0d4a80;
            border: 1px solid #a7d0ff;
        }

        .variables-count {
            text-align: center;
            font-size: 11px;
            color: #8c8c8c;
            margin: 12px 0;
        }

        .icon {
            width: 16px;
            height: 16px;
            display: inline-block;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #e6e6e6;
            border-radius: 50%;
            border-top-color: #0d99ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>CSS Variables Converter</h1>
        <p>Convert Figma variables to development-friendly format</p>
    </div>

    <div id="status-message" class="hidden"></div>

    <div class="section">
        <h2>🎨 Convert Variables</h2>
        <p style="font-size: 11px; color: #8c8c8c; margin-bottom: 12px;">
            Updates Figma web devmode with CSS variable names
        </p>
        <button id="convert-btn" class="button button-primary">
            <span class="icon">🔄</span>
            Convert Variables to Dev Format
        </button>
        <div id="variables-count" class="variables-count hidden"></div>
    </div>

    <div class="section">
        <h2>📤 Export to GitHub</h2>
        <p style="font-size: 11px; color: #8c8c8c; margin-bottom: 12px;">
            Generate CSS file and push to your repository
        </p>
        <button id="export-btn" class="button button-secondary" disabled>
            <span class="icon">📤</span>
            Export CSS to GitHub
        </button>
        <div id="export-status" class="hidden" style="font-size: 10px; color: #8c8c8c; margin-top: 8px; text-align: center;">
            Convert variables first to enable export
        </div>
    </div>

    <script>
        const convertBtn = document.getElementById('convert-btn');
        const exportBtn = document.getElementById('export-btn');
        const statusMessage = document.getElementById('status-message');
        const variablesCount = document.getElementById('variables-count');
        const exportStatus = document.getElementById('export-status');

        let convertedVariables = null;

        // Show status message
        function showStatus(message, type = 'info') {
            statusMessage.className = `status status-${type}`;
            statusMessage.textContent = message;
            statusMessage.classList.remove('hidden');
        }

        // Hide status message
        function hideStatus() {
            statusMessage.classList.add('hidden');
        }

        // Update button loading state
        function setButtonLoading(button, loading, loadingText) {
            if (loading) {
                button.innerHTML = `<span class="loading"></span> ${loadingText}`;
                button.disabled = true;
            } else {
                // Reset button content based on which button it is
                if (button.id === 'convert-btn') {
                    button.innerHTML = '<span class="icon">🔄</span> Convert Variables to Dev Format';
                } else if (button.id === 'export-btn') {
                    button.innerHTML = '<span class="icon">📤</span> Export CSS to GitHub';
                }
                button.disabled = false;
            }
        }

        // Convert variables
        convertBtn.addEventListener('click', async () => {
            hideStatus();
            setButtonLoading(convertBtn, true, 'Converting...');
            variablesCount.classList.add('hidden');

            try {
                // Send message to main plugin code to convert variables
                parent.postMessage({ 
                    pluginMessage: { 
                        type: 'convert-variables' 
                    } 
                }, '*');
            } catch (error) {
                showStatus('Failed to start conversion', 'error');
                setButtonLoading(convertBtn, false);
            }
        });

        // Export to GitHub
        exportBtn.addEventListener('click', async () => {
            if (!convertedVariables) {
                showStatus('Convert variables first', 'error');
                return;
            }

            hideStatus();
            setButtonLoading(exportBtn, true, 'Exporting...');

            try {
                // Send message to main plugin code to export to GitHub
                parent.postMessage({ 
                    pluginMessage: { 
                        type: 'export-github',
                        variables: convertedVariables
                    } 
                }, '*');
            } catch (error) {
                showStatus('Failed to start export', 'error');
                setButtonLoading(exportBtn, false);
            }
        });

        // Listen for messages from the main plugin code
        window.addEventListener('message', (event) => {
            const { type, data } = event.data.pluginMessage || {};

            switch (type) {
                case 'convert-success':
                    convertedVariables = data.variables;
                    showStatus(`✅ Converted ${data.count} variables successfully`, 'success');
                    variablesCount.textContent = `${data.count} variables ready for export`;
                    variablesCount.classList.remove('hidden');
                    exportBtn.disabled = false;
                    exportBtn.classList.remove('button-secondary');
                    exportBtn.classList.add('button-primary');
                    exportStatus.classList.add('hidden');
                    setButtonLoading(convertBtn, false);
                    break;

                case 'convert-error':
                    showStatus(`❌ Conversion failed: ${data.message}`, 'error');
                    setButtonLoading(convertBtn, false);
                    break;

                case 'export-success':
                    showStatus(`✅ Successfully exported to GitHub`, 'success');
                    setButtonLoading(exportBtn, false);
                    break;

                case 'export-error':
                    showStatus(`❌ Export failed: ${data.message}`, 'error');
                    setButtonLoading(exportBtn, false);
                    break;

                case 'status-update':
                    showStatus(data.message, data.type || 'info');
                    break;
            }
        });

        // Auto-focus on load
        window.addEventListener('load', () => {
            convertBtn.focus();
        });
    </script>
</body>
</html>